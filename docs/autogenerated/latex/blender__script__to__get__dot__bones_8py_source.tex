\hypertarget{blender__script__to__get__dot__bones_8py_source}{}\doxysection{blender\+\_\+script\+\_\+to\+\_\+get\+\_\+dot\+\_\+bones.\+py}
\label{blender__script__to__get__dot__bones_8py_source}\index{libs/engine/blender\_script\_to\_get\_dot\_bones.py@{libs/engine/blender\_script\_to\_get\_dot\_bones.py}}
\mbox{\hyperlink{blender__script__to__get__dot__bones_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00001}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones}{00001}}\ \textcolor{keyword}{import}\ bpy,\ sys,\ mathutils,\ itertools,\ math}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00003}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a00acf8bb534748a5b220d233f71b10cb}{00003}}\ context\ =\ bpy.context}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00004}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a9f5a37f267a78a7232f34ae43aa473e5}{00004}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a9f5a37f267a78a7232f34ae43aa473e5}{prant}}(*args,\ **kwargs):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00005}00005\ \ \ \ \ \textcolor{comment}{\#file\ =\ open(filename,\ "{}a"{})}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00006}00006\ \ \ \ \ \textcolor{keywordflow}{for}\ a\ \textcolor{keywordflow}{in}\ context.screen.areas:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00007}00007\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ a.type\ ==\ \textcolor{stringliteral}{'CONSOLE'}:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00008}00008\ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00009}00009\ \ \ \ \ \ \ \ \ \ \ \ \ c[\textcolor{stringliteral}{'area'}]\ =\ a}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00010}00010\ \ \ \ \ \ \ \ \ \ \ \ \ c[\textcolor{stringliteral}{'space\_data'}]\ =\ a.spaces.active}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00011}00011\ \ \ \ \ \ \ \ \ \ \ \ \ c[\textcolor{stringliteral}{'region'}]\ =\ a.regions[-\/1]}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00012}00012\ \ \ \ \ \ \ \ \ \ \ \ \ c[\textcolor{stringliteral}{'window'}]\ =\ context.window}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00013}00013\ \ \ \ \ \ \ \ \ \ \ \ \ c[\textcolor{stringliteral}{'screen'}]\ =\ context.screen}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00014}00014\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ \textcolor{stringliteral}{"{}\ "{}}.join([str(arg)\ \textcolor{keywordflow}{for}\ arg\ \textcolor{keywordflow}{in}\ args])}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00015}00015\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ line\ \textcolor{keywordflow}{in}\ s.split(\textcolor{stringliteral}{"{}\(\backslash\)n"{}}):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00016}00016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bpy.ops.console.scrollback\_append(c,\ text=line)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00017}00017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#file.write(line\ +\ "{}\(\backslash\)n"{})}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00019}00019\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00020}00020\ \textcolor{stringliteral}{prant(context.object.name)}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00021}00021\ \textcolor{stringliteral}{prant(context.object.animation\_data)}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00022}00022\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00023}00023\ \textcolor{stringliteral}{if\ context.object.type\ ==\ 'ARMATURE':}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00024}00024\ \textcolor{stringliteral}{\ \ \ \ armature\ =\ context.object.data}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00025}00025\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{keywordflow}{for}\ bone\ \textcolor{keywordflow}{in}\ armature.bones:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00026}00026\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a9f5a37f267a78a7232f34ae43aa473e5}{prant}}(f\textcolor{stringliteral}{'"{}\{bone.name\}"{},'})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00027}00027\ \textcolor{comment}{\#"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00029}00029\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00030}00030\ \textcolor{stringliteral}{esqueleto\ =\ bpy.data.objects['Esqueleto']}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00031}00031\ \textcolor{stringliteral}{\#prant(esqueleto.pose.bones['L.pie'].matrix)}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00032}00032\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00033}00033\ \textcolor{stringliteral}{path\ =\ "{}/home/tomas/Documentos/proyectos/Proyecto\ Posta/build/app/assets/blender\_matrices.txt"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00034}00034\ \textcolor{stringliteral}{t\ =\ "{}"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00035}00035\ \textcolor{stringliteral}{for\ bone\ in\ esqueleto.pose.bones:}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00036}00036\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{comment}{\#t\ +=\ "{}\(\backslash\)n"{}\ +\ bone.name\ +\ "{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00037}00037\ \ \ \ \ \textcolor{keywordflow}{for}\ v\ \textcolor{keywordflow}{in}\ bone.matrix:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00038}00038\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ e\ \textcolor{keywordflow}{in}\ v:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ \ \ \ \ t\ +=\ str(e)\ +\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00040}00040\ \textcolor{keyword}{with}\ open(path,\ \textcolor{stringliteral}{"{}w"{}})\ \textcolor{keyword}{as}\ file:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00041}00041\ \ \ \ \ file.write(t)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00043}00043\ \textcolor{comment}{\#"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00045}00045\ \textcolor{comment}{\#\ Returns\ the\ index\ of\ the\ bone}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00046}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_acd4623151eaba844b9af43a38281962a}{00046}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_acd4623151eaba844b9af43a38281962a}{get\_index\_from\_bone\_name}}(name):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00047}00047\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ pb\ \textcolor{keywordflow}{in}\ enumerate(bpy.context.active\_object.parent.pose.bones):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pb.name\ ==\ name:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ i}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00051}00051\ \textcolor{comment}{\#\ The\ function\ expects\ a\ mesh\ (with\ an\ armature)\ to\ be\ selected}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00052}00052\ \textcolor{comment}{\#\ Saves\ in\ path\ a\ .bones\ file\ with\ the\ information\ about\ each\ vertex\ bone\ influences,\ starting\ from\ vertex\ 0}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00053}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a81a2d50a48e9a8d0ab6c91901c7baad5}{00053}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a81a2d50a48e9a8d0ab6c91901c7baad5}{save\_bones\_file}}(path):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00054}00054\ \ \ \ \ \textcolor{keyword}{with}\ open(path,\ \textcolor{stringliteral}{"{}w"{}})\ \textcolor{keyword}{as}\ file:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ obj\ =\ bpy.context.active\_object}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ get\ the\ names\ of\ the\ bones\ in\ the\ armature\ associated\ with\ the\ object}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ modifier\ \textcolor{keywordflow}{in}\ obj.modifiers:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ modifier.type\ ==\ \textcolor{stringliteral}{'ARMATURE'}:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ armature\ =\ modifier.object.data}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ armature\_bones\ =\ \{bone.name\ \textcolor{keywordflow}{for}\ bone\ \textcolor{keywordflow}{in}\ armature.bones\}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ get\ the\ mapping\ from\ group\ indices\ to\ bones}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ group\_to\_bone\ =\ \{i:\ group.name\ \textcolor{keywordflow}{for}\ i,\ group\ \textcolor{keywordflow}{in}\ enumerate(obj.vertex\_groups)\}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ determine\ the\ bone\ weights\ associated\ with\ each\ vertex}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ mesh\ =\ obj.data}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ vertex\ \textcolor{keywordflow}{in}\ mesh.vertices:\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ file.write(str(vertex.index)\ +\ \textcolor{stringliteral}{"{}\ "{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ group\ \textcolor{keywordflow}{in}\ vertex.groups:\ \textcolor{comment}{\#first\ loop\ to\ calculate\ the\ total\ weight\ and\ the\ space\ allowed\ if\ some\ are\ locked}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ group\_index\ =\ group.group}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ group\_bone\ =\ group\_to\_bone[group\_index]}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ group\_bone\ \textcolor{keywordflow}{in}\ armature\_bones:\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file.write(str(\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_acd4623151eaba844b9af43a38281962a}{get\_index\_from\_bone\_name}}(group\_bone))\ +\ \textcolor{stringliteral}{"{}|"{}}\ +\ str(group.weight)\ +\ \textcolor{stringliteral}{"{},"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#else:}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ prant('\ \ \ \ ',\ 'NOT\ A\ BONE:',\ group\_bone,\ group.weight)}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ file.write(\textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00081}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_ab6367529223fbf061be04781c9d56bd3}{00081}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_ab6367529223fbf061be04781c9d56bd3}{first\_frame}}():}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00082}00082\ \ \ \ \ bpy.context.scene.frame\_set(0)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00084}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a8323a9108298816060820f0cf9d633ed}{00084}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a8323a9108298816060820f0cf9d633ed}{set\_frame}}(frame):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00085}00085\ \ \ \ \ bpy.context.scene.frame\_set(frame)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00087}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a63c28d4057ab196ee5a85a318fb05eb4}{00087}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a63c28d4057ab196ee5a85a318fb05eb4}{next\_frame}}(sample\_rate):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00088}00088\ \ \ \ \ bpy.context.scene.frame\_set(min(bpy.context.scene.frame\_current\ +\ sample\_rate,\ bpy.context.scene.frame\_end))}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00090}00090\ \textcolor{comment}{\#\ Transforms\ blender\ axes\ to\ opengl\ axes}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00091}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_aece388e7d5ca7cf1377446fb995a1d9a}{00091}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_aece388e7d5ca7cf1377446fb995a1d9a}{to\_opengl\_axes}}(element):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00092}00092\ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(element,\ mathutils.Vector):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ vector\ =\ element}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mathutils.Vector((vector.x,\ vector.z,\ -\/vector.y))\ \textcolor{comment}{\#\ DEBUG}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00095}00095\ \ \ \ \ \textcolor{keywordflow}{elif}\ isinstance(element,\ mathutils.Quaternion):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ quate\ =\ element}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ quate.rotate(mathutils.Euler((-\/math.pi\ /\ 2,\ 0,\ 0)))}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ quate}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#eula\ =\ quate.to\_euler('XYZ')}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#return\ mathutils.Euler((eula.x,\ eula.z,\ -\/eula.y),\ 'XYZ').to\_quaternion()}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00101}00101\ \ \ \ \ \textcolor{keywordflow}{raise}\ TypeError()}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00103}00103\ \textcolor{comment}{\#\ The\ function\ expects\ an\ armature\ to\ be\ selected}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00104}00104\ \textcolor{comment}{\#\ Saves\ in\ a\ .skl\ file\ the\ skeleton\ structure\ along\ with\ its\ rest\ transforms}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00105}00105\ \textcolor{comment}{\#\ It\ also\ saves\ the\ animations\ in\ the\ same\ directory\ (argument\ path)\ as\ .anm\ files}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00106}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_acae32bdab68987ef97bed499566959ee}{00106}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_acae32bdab68987ef97bed499566959ee}{save\_skeleton\_and\_animations}}(path,\ skeleton\_filename,\ sample\_rate):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00107}00107\ \ \ \ \ \textcolor{keyword}{def\ }get\_skeleton\_pose\_data(obj):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ bones\_transforms\ =\ []}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ pb\ \textcolor{keywordflow}{in}\ obj.pose.bones:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#loc\ =\ obj.matrix\_world\ @\ mathutils.Vector(pb.head)}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ loc\ =\ obj.matrix\_world\ @\ mathutils.Vector(pb.matrix.to\_translation())}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ rot\ =\ mathutils.Quaternion(pb.matrix.to\_quaternion())}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ bones\_transforms.append((loc,\ rot,\ (pb.head\ -\/\ pb.tail).length))}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ bones\_transforms}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00116}00116\ \ \ \ \ \textcolor{keyword}{def\ }get\_animation(obj,\ nla\_track,\ sample\_rate):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ frames\ =\ []}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a8323a9108298816060820f0cf9d633ed}{set\_frame}}(int(nla\_track.strips[0].frame\_start))}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range((int(nla\_track.strips[0].frame\_end)\ -\/\ int(nla\_track.strips[0].frame\_start)\ +\ 1)\ //\ sample\_rate):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ frames.append(get\_skeleton\_pose\_data(obj))}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ jumping\ to\ next\ frame\ of\ animation}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a63c28d4057ab196ee5a85a318fb05eb4}{next\_frame}}(sample\_rate)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ frames}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00125}00125\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00126}00126\ \ \ \ \ obj\ =\ bpy.context.active\_object}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00127}00127\ \ \ \ \ bpy.ops.object.mode\_set(mode=\textcolor{stringliteral}{'POSE'})\ \textcolor{comment}{\#\ sets\ pose\ mode\ if\ not\ set\ already}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00128}00128\ \ \ \ \ \textcolor{keywordflow}{for}\ pb\ \textcolor{keywordflow}{in}\ obj.pose.bones:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ pb.bone.select\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00130}00130\ \ \ \ \ bpy.ops.pose.transforms\_clear()}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00132}00132\ \ \ \ \ \textcolor{comment}{\#\ saving\ skeleton\ structure}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00133}00133\ \ \ \ \ \textcolor{keyword}{with}\ open(path\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ skeleton\_filename,\ \textcolor{stringliteral}{"{}w"{}})\ \textcolor{keyword}{as}\ file:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ pb,\ bone\ \textcolor{keywordflow}{in}\ zip(obj.pose.bones,\ get\_skeleton\_pose\_data(obj)):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ file.write(f\textcolor{stringliteral}{"{}\{pb.name\}\ \{pb.parent\_recursive[0].name\ if\ pb.parent\_recursive\ else\ ''\}\ \{bone[2]\}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00136}00136\ \ \ \ \ \textcolor{comment}{\#\ saving\ skeleton\ rest\ pose\ data}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00137}00137\ \ \ \ \ \textcolor{keyword}{with}\ open(path\ +\ \textcolor{stringliteral}{"{}/rest.anmr"{}},\ \textcolor{stringliteral}{"{}w"{}})\ \textcolor{keyword}{as}\ file:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ bone\ \textcolor{keywordflow}{in}\ get\_skeleton\_pose\_data(obj):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ location\ =\ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_aece388e7d5ca7cf1377446fb995a1d9a}{to\_opengl\_axes}}(bone[0])}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ \ \ \ \ rotation\ =\ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_aece388e7d5ca7cf1377446fb995a1d9a}{to\_opengl\_axes}}(bone[1])}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ file.write(\textcolor{stringliteral}{"{}\ "{}}.join([str(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ itertools.chain(location,\ rotation)])\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00142}00142\ \ \ \ \ \textcolor{keywordflow}{if}\ obj.animation\_data\ !=\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ for\ each\ animation\ record\ each\ bone\ location\ and\ rotation}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ final\_animations\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ animation\ \textcolor{keywordflow}{in}\ obj.animation\_data.nla\_tracks:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ selecting\ animation}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ anim\ \textcolor{keywordflow}{in}\ obj.animation\_data.nla\_tracks:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ anim.mute\ =\ \textcolor{keywordflow}{not}\ anim\ ==\ animation}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ reading\ pose\ data}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ final\_animations[animation.name]\ =\ get\_animation(obj,\ animation,\ sample\_rate)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#prant(final\_animations.keys())}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00152}00152\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ saving\ animations}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ anim\ \textcolor{keywordflow}{in}\ final\_animations:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(path\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ anim\ +\ \textcolor{stringliteral}{"{}.anm"{}},\ \textcolor{stringliteral}{"{}w"{}})\ \textcolor{keyword}{as}\ file:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file.write(str(bpy.context.scene.render.fps)\ +\ \textcolor{stringliteral}{"{}\ \#\ fps\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00157}00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file.write(str(len(final\_animations[anim]))\ +\ \textcolor{stringliteral}{"{}\ \#\ frames\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file.write(str(sample\_rate)\ +\ \textcolor{stringliteral}{"{}\ \#\ sample\ rate\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file.write(str(len(final\_animations[anim][0]))\ +\ \textcolor{stringliteral}{"{}\ \#\ bones\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#prant("{}voy!"{})}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ frame\ \textcolor{keywordflow}{in}\ final\_animations[anim]:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ bone\ \textcolor{keywordflow}{in}\ frame:}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#prant(bone)}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ location\ =\ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_aece388e7d5ca7cf1377446fb995a1d9a}{to\_opengl\_axes}}(bone[0])}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rotation\ =\ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_aece388e7d5ca7cf1377446fb995a1d9a}{to\_opengl\_axes}}(bone[1])}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file.write(\textcolor{stringliteral}{"{}\ "{}}.join([str(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ itertools.chain(location,\ rotation)])\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00168}00168\ \textcolor{comment}{\#\ The\ function\ expects\ a\ mesh\ to\ be\ selected}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00169}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a166758492c6d3627930fa0840a07625d}{00169}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a166758492c6d3627930fa0840a07625d}{save\_obj}}(path):}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00170}00170\ \ \ \ \ bpy.ops.export\_scene.obj(filepath=path,\ use\_materials=\textcolor{keyword}{False},\ use\_triangles=\textcolor{keyword}{True},\ use\_selection=\textcolor{keyword}{True},\ axis\_forward=\textcolor{stringliteral}{'-\/Z'},\ axis\_up=\textcolor{stringliteral}{'Y'},\ use\_mesh\_modifiers=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00171}00171\ \ \ \ \ \textcolor{comment}{\#bpy.ops.export\_scene.obj(filepath=path,\ use\_materials=False,\ use\_triangles=True,\ use\_selection=True,\ axis\_forward='Y',\ axis\_up='Z',\ use\_mesh\_modifiers=False)\ \#\ DEBUG}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00173}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_a7e678be051cc2bdc089d86204e915978}{00173}}\ assets\_directory\ =\ \textcolor{stringliteral}{"{}C:\(\backslash\)\(\backslash\)Users\(\backslash\)\(\backslash\)tomas\(\backslash\)\(\backslash\)Documents\(\backslash\)\(\backslash\)guardable\(\backslash\)\(\backslash\)Proyecto\ Posta\(\backslash\)\(\backslash\)build\(\backslash\)\(\backslash\)app\(\backslash\)\(\backslash\)assets\(\backslash\)\(\backslash\)"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00174}\mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_ab7071572acd767fcebf36ff3da6a5197}{00174}}\ base\_directory\ =\ assets\_directory\ +\ \textcolor{stringliteral}{"{}test/"{}}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00176}00176\ \textcolor{comment}{\#save\_obj(base\_directory\ +\ "{}test.obj"{})}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00177}00177\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00178}00178\ \textcolor{comment}{\#save\_bones\_file(base\_directory\ +\ "{}test.bones"{})}}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00179}00179\ \mbox{\hyperlink{namespaceblender__script__to__get__dot__bones_acae32bdab68987ef97bed499566959ee}{save\_skeleton\_and\_animations}}(base\_directory,\ \textcolor{stringliteral}{"{}skeleton.skl"{}},\ 1)}
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00180}00180\ }
\DoxyCodeLine{\Hypertarget{blender__script__to__get__dot__bones_8py_source_l00181}00181\ }

\end{DoxyCode}
