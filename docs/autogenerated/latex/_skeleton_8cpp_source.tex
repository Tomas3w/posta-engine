\hypertarget{_skeleton_8cpp_source}{}\doxysection{Skeleton.\+cpp}
\label{_skeleton_8cpp_source}\index{libs/engine/src/Component/Skeleton.cpp@{libs/engine/src/Component/Skeleton.cpp}}
\mbox{\hyperlink{_skeleton_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_skeleton_8h}{engine/include/Component/Skeleton.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00003}00003\ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton}{Engine::Component::Skeleton}};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00005}00005\ \mbox{\hyperlink{class_engine_1_1_component_1_1_transform}{Engine::Component::Transform}}\ Skeleton::str\_to\_transform(std::string\ s)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00006}00006\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00007}00007\ \ \ \ \ std::stringstream\ s\_s(s);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00008}00008\ \ \ \ \ std::string\ number;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00009}00009\ \ \ \ \ std::vector<float>\ numbers;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00010}00010\ \ \ \ \ \textcolor{keywordflow}{while}\ (getline(s\_s,\ number,\ \textcolor{charliteral}{'\ '}))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00011}00011\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00012}00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!number.empty())}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00013}00013\ \ \ \ \ \ \ \ \ \ \ \ \ numbers.push\_back(stof(number));}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00014}00014\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00015}00015\ \ \ \ \ Transform\ transform(glm::vec3(numbers[0],\ numbers[1],\ numbers[2]));}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00016}00016\ \ \ \ \ transform.set\_rotation(glm::quat(numbers[3],\ numbers[4],\ numbers[5],\ numbers[6]));}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00017}00017\ \ \ \ \ \textcolor{keywordflow}{return}\ transform;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00018}00018\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00020}00020\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ print\_bones(std::vector<Skeleton::Bone>\&\ bones,\ std::vector<Engine::Component::Transform>\ bone\_transforms,\ \textcolor{keywordtype}{int}\ level\ =\ 0)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00021}00021\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00022}00022\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ bone\ :\ bones)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00023}00023\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00024}00024\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ level;\ i++)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)t"{}};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00026}00026\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ bone.index\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ bone.name\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ bone.parent\_name\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ to\_string(bone\_transforms[bone.index].get\_position())\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00027}00027\ \ \ \ \ \ \ \ \ \ \ \ \ to\_string(bone\_transforms[bone.index].get\_rotation())\ <<\ \textcolor{stringliteral}{"{}|"{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00028}00028\ \ \ \ \ \ \ \ \ print\_bones(bone.children,\ bone\_transforms,\ level\ +\ 1);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00029}00029\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00030}00030\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00032}\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_acb77c8b2dbe6dc7d11c54ffec60d6f5b}{00032}}\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Skeleton::Bone}}*\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_acb77c8b2dbe6dc7d11c54ffec60d6f5b}{Skeleton::Bone::search\_in\_bones}}(\textcolor{keyword}{const}\ std::string\ bone\_name,\ std::vector<Bone>\&\ bones)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00033}00033\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00034}00034\ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Skeleton::Bone}}*\ rbone\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}\&\ bone\ :\ bones)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00036}00036\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00037}00037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bone.name\ ==\ bone\_name)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&bone;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00039}00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((rbone\ =\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_acb77c8b2dbe6dc7d11c54ffec60d6f5b}{search\_in\_bones}}(bone\_name,\ bone.children)))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rbone;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00041}00041\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00042}00042\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00043}00043\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00045}\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a430ee66568df0510328ad67e2f7234ae}{00045}}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a430ee66568df0510328ad67e2f7234ae}{Skeleton::Bone::count\_of\_bones}}(std::vector<Bone>\&\ bones)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00046}00046\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00047}00047\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ bones.size();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00048}00048\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ bone\ :\ bones)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00049}00049\ \ \ \ \ \ \ \ \ count\ +=\ count\_of\_bones(bone.children);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00050}00050\ \ \ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00051}00051\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00052}00052\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00053}\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{00053}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{Skeleton::Bone::on\_bones}}(std::vector<Bone>\&\ bones,\ std::function<\textcolor{keywordtype}{void}(\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}*)>\ func)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00054}00054\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00055}00055\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ bone\ :\ bones)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00056}00056\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ func(\&bone);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{on\_bones}}(bone.children,\ func);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00059}00059\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00060}00060\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00062}\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_ad30614168c9d96bce8ae64e228817efa}{00062}}\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_ad30614168c9d96bce8ae64e228817efa}{Skeleton::Skeleton}}(std::filesystem::path\ path)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00063}00063\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00064}00064\ \ \ \ \ std::filesystem::path\ skl\_filename\ =\ path\ /\ \textcolor{stringliteral}{"{}skeleton.skl"{}};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00065}00065\ \ \ \ \ std::filesystem::path\ rest\_filename\ =\ path\ /\ \textcolor{stringliteral}{"{}rest.anmr"{}};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00066}00066\ \ \ \ \ \textcolor{comment}{//\ collecting\ rest\ transforms}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00067}00067\ \ \ \ \ std::ifstream\ file(rest\_filename);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00068}00068\ \ \ \ \ \textcolor{keywordflow}{if}\ (!file)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00069}00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(std::string(\textcolor{stringliteral}{"{}couldn't\ find\ .anmr\ file:\ "{}})\ +\ rest\_filename.string());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00070}00070\ \ \ \ \ std::string\ line;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00071}00071\ \ \ \ \ \textcolor{keywordflow}{while}\ (getline(file,\ line))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ rest\_transforms.push\_back(str\_to\_transform(line));}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00073}00073\ \ \ \ \ file.close();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00074}00074\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00075}00075\ \ \ \ \ \textcolor{comment}{//\ loading\ bones}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00076}00076\ \ \ \ \ std::vector<Skeleton::Bone>\ bones;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00077}00077\ \ \ \ \ file.open(skl\_filename);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00078}00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (!file)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(std::string(\textcolor{stringliteral}{"{}couldn't\ find\ .skl\ file:\ "{}})\ +\ skl\_filename.string());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00080}00080\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00081}00081\ \ \ \ \ \textcolor{keywordflow}{while}\ (getline(file,\ line))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00082}00082\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}\ bone;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ bone.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}\ =\ i;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ std::vector<std::string>\ parts\ =\ \mbox{\hyperlink{namespace_engine_aa5b2c22b6569ecb716efec0463f5c85f}{Engine::split}}(line,\ \textcolor{charliteral}{'\ '});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ bone.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a68ab911beb77e4a719130abe4b40df7d}{name}}\ =\ parts[0];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ bone.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_ab86cb084470d7d7a945684dfdb596cff}{parent\_name}}\ =\ parts[1];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ bone.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_aa2c15c48bb7d2f3012761091a21dc687}{length}}\ =\ stof(parts[2]);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ bone.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_afa3a8e2c71544d34604a84d2db4a3eba}{parent}}\ =\ \textcolor{keyword}{nullptr};\ \textcolor{comment}{//\ this\ should\ be\ null\ by\ default}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bone.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_ab86cb084470d7d7a945684dfdb596cff}{parent\_name}}.empty())}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}}.push\_back(bone);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ bones.push\_back(bone);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00094}00094\ \ \ \ \ \ \ \ \ i++;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00095}00095\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00096}00096\ \ \ \ \ file.close();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00098}00098\ \ \ \ \ \textcolor{comment}{//\ creating\ the\ tree\ of\ bones}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00099}00099\ \ \ \ \ \textcolor{keywordflow}{while}\ (!bones.empty())}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00100}00100\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ bones.begin();\ it\ !=\ bones.end();\ it++)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00102}00102\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}*\ bone\ =\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_acb77c8b2dbe6dc7d11c54ffec60d6f5b}{Bone::search\_in\_bones}}(it-\/>parent\_name,\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bone)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ it-\/>parent\ =\ bone;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_aa3f743c0293b9639157781ba8c13ab2f}{children}}.push\_back(*it);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ it\ =\ bones.erase(it)\ -\/\ 1;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00110}00110\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00111}00111\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00112}00112\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00113}00113\ \ \ \ \ \textcolor{comment}{//\ bones\ to\ rest\_matrices\ and\ to\ bone\_transforms}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00114}00114\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a430ee66568df0510328ad67e2f7234ae}{Bone::count\_of\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00115}00115\ \ \ \ \ rest\_matrices.resize(count);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00116}00116\ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}.resize(count);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00117}00117\ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{Bone::on\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}},\ [\&](\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}*\ bone)\{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00118}00118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}]\ =\ rest\_transforms[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}];\ \textcolor{comment}{//\ local\ to\ object\ transform,\ not\ to\ parent\ bone}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00119}00119\ \ \ \ \ \ \ \ \ rest\_matrices[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}]\ =\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}].get\_matrix();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00120}00120\ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00121}00121\ \ \ \ \ models.resize(\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a430ee66568df0510328ad67e2f7234ae}{Bone::count\_of\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}}),\ glm::mat4(1.0f));}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00122}00122\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00124}\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_aa45efb034a5515d1bec1e11a91d8701d}{00124}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_aa45efb034a5515d1bec1e11a91d8701d}{Skeleton::add\_animation}}(std::filesystem::path\ path)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00125}00125\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00126}00126\ \ \ \ \ std::ifstream\ file(path);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00127}00127\ \ \ \ \ \textcolor{keywordflow}{if}\ (!file)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00128}00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(std::string(\textcolor{stringliteral}{"{}couldn't\ find\ .anm\ file:\ "{}})\ +\ path.string());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00129}00129\ \ \ \ \ std::string\ line;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00130}00130\ \ \ \ \ \textcolor{comment}{//\ getting\ data\ from\ file}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00131}00131\ \ \ \ \ \textcolor{comment}{//\ fps}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00132}00132\ \ \ \ \ getline(file,\ line);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00133}00133\ \ \ \ \ \textcolor{keyword}{auto}\ vec\ =\ \mbox{\hyperlink{namespace_engine_aa5b2c22b6569ecb716efec0463f5c85f}{Engine::split}}(line,\ \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00134}00134\ \ \ \ \ \textcolor{keywordtype}{float}\ fps\ =\ stof(vec[0]);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00135}00135\ \ \ \ \ \textcolor{comment}{//\ frames}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00136}00136\ \ \ \ \ getline(file,\ line);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00137}00137\ \ \ \ \ vec\ =\ \mbox{\hyperlink{namespace_engine_aa5b2c22b6569ecb716efec0463f5c85f}{Engine::split}}(line,\ \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00138}00138\ \ \ \ \ \textcolor{keywordtype}{int}\ frames\ =\ stoi(vec[0]);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00139}00139\ \ \ \ \ \textcolor{comment}{//\ sample\ rate}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00140}00140\ \ \ \ \ getline(file,\ line);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00141}00141\ \ \ \ \ vec\ =\ \mbox{\hyperlink{namespace_engine_aa5b2c22b6569ecb716efec0463f5c85f}{Engine::split}}(line,\ \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00142}00142\ \ \ \ \ \textcolor{keywordtype}{int}\ sample\_rate\ =\ stoi(vec[0]);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00143}00143\ \ \ \ \ \textcolor{comment}{//\ bones\ count}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00144}00144\ \ \ \ \ getline(file,\ line);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00145}00145\ \ \ \ \ vec\ =\ \mbox{\hyperlink{namespace_engine_aa5b2c22b6569ecb716efec0463f5c85f}{Engine::split}}(line,\ \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00146}00146\ \ \ \ \ \textcolor{keywordtype}{int}\ bone\_count\ =\ stoi(vec[0]);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00147}00147\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(bone\_count)\ !=\ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a430ee66568df0510328ad67e2f7234ae}{Bone::count\_of\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}}))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00148}00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(std::string(\textcolor{stringliteral}{"{}number\ of\ bones\ of\ animation\ is\ not\ equal\ to\ bones\ of\ skeleton,\ in\ file:\ "{}})\ +\ path.string());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00150}00150\ \ \ \ \ Animation*\ animation\ =\ \textcolor{keyword}{new}\ Animation;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00151}00151\ \ \ \ \ animation-\/>duration\ =\ frames\ *\ sample\_rate\ /\ fps;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00152}00152\ \ \ \ \ animation-\/>frames.resize(frames);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00153}00153\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ 0;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00154}00154\ \ \ \ \ \textcolor{keywordflow}{while}\ (getline(file,\ line))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00155}00155\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00156}00156\ \ \ \ \ \ \ \ \ animation-\/>frames[i\ /\ bone\_count].push\_back(Skeleton::str\_to\_transform(line));}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00157}00157\ \ \ \ \ \ \ \ \ i++;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00158}00158\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00159}00159\ \ \ \ \ file.close();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00160}00160\ \ \ \ \ \textcolor{comment}{//std::cout\ <<\ "{}frames\ of\ animation:\ "{}\ <<\ animation-\/>frames.size()\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00161}00161\ \ \ \ \ \textcolor{comment}{//if\ (!animation-\/>frames.empty())}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00162}00162\ \ \ \ \ \textcolor{comment}{//\ \ std::cout\ <<\ "{}bones\ per\ frame:\ "{}\ <<\ animation-\/>frames[0].size()\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00163}00163\ \ \ \ \ animations[path.stem().string()].reset(animation);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00164}00164\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00166}\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_ae412a8354c82ad25264136d4552bc061}{00166}}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_ae412a8354c82ad25264136d4552bc061}{Skeleton::get\_animation\_duration}}(std::string\ name)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00167}00167\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00168}00168\ \ \ \ \ \textcolor{keywordflow}{if}\ (animations.count(name))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00169}00169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ animations[name]-\/>duration;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00170}00170\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00171}00171\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00173}\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a1906c738d19bb4084ba2c052317e26be}{00173}}\ \mbox{\hyperlink{class_engine_1_1span}{Engine::span<Engine::anim\_mat4>}}\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a1906c738d19bb4084ba2c052317e26be}{Skeleton::get\_animation\_matrices}}(\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player}{AnimationPlayer}}\&\ player,\ \textcolor{keywordtype}{bool}\ advance\_time)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00174}00174\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00175}00175\ \ \ \ \ \textcolor{comment}{//\ Getting\ and\ updating\ bone\_transforms}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00176}00176\ \ \ \ \ \textcolor{keyword}{auto}\&\ animation\ =\ player.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player_a61184ccf75ffe240cde8d2cf7f04e830}{animations}}[0];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00177}00177\ \ \ \ \ \textcolor{keywordflow}{if}\ (!animations.count(animation.name))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00178}00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(std::string(\textcolor{stringliteral}{"{}couldn't\ find\ the\ animation\ named:\ "{}})\ +\ animation.name);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00179}00179\ \ \ \ \ \textcolor{keyword}{auto}\&\ anim\ =\ animations[animation.name];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00180}00180\ \ \ \ \ \textcolor{keyword}{auto}\&\ frame\ =\ anim-\/>frames[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(fmod(player.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player_ae1888f164c726201fa7ed9da0bb954d1}{time}},\ anim-\/>duration)\ *\ anim-\/>frames.size()\ /\ anim-\/>duration)];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00181}00181\ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}\ =\ frame;\ \textcolor{comment}{//\ copying\ frame\ to\ bones}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00182}00182\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00183}00183\ \ \ \ \ \textcolor{comment}{//\ Getting\ matrices\ from\ bone\_transforms}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00184}00184\ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00185}00185\ \ \ \ \ \textcolor{keyword}{auto}\ jt\ =\ rest\_matrices.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00186}00186\ \ \ \ \ \textcolor{keyword}{auto}\ kt\ =\ models.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00187}00187\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ ft\ =\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}.end();\ it\ !=\ ft;\ it++,\ jt++,\ kt++)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00188}00188\ \ \ \ \ \ \ \ \ (*kt)\ =\ it-\/>get\_matrix()\ *\ glm::inverse(*jt);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00189}00189\ \ \ \ \ \textcolor{keywordflow}{if}\ (advance\_time)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00190}00190\ \ \ \ \ \ \ \ \ player.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player_ae1888f164c726201fa7ed9da0bb954d1}{time}}\ +=\ \mbox{\hyperlink{class_engine_1_1_app_a6f926dc22fc1fd49ee6d94e44292e62d}{App::app}}-\/>\mbox{\hyperlink{class_engine_1_1_app_a7c0e5165d1e0612c7e4f5b838cfd4c8c}{delta\_time}};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00191}00191\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_engine_1_1span}{Engine::span<Engine::anim\_mat4>}}(models.data(),\ models.size());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00192}00192\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00194}00194\ std::vector<std::vector<Engine::Component::Transform>>\&\ Skeleton::Animation::get\_local\_frames(std::vector<Bone>\&\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}})}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00195}00195\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00196}00196\ \ \ \ \ \textcolor{comment}{//\ TOTEST}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00197}00197\ \ \ \ \ \textcolor{keywordflow}{if}\ (local\_frames.empty())}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00198}00198\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00199}00199\ \ \ \ \ \ \ \ \ local\_frames.resize(frames.size());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00200}00200\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ local\_frames.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00201}00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ frame\ :\ frames)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00202}00202\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \ \ \ (*it).resize(frame.size());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ local\_frame\ =\ (*it);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{Bone::on\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}},\ [\&](Bone*\ bone)\{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bone-\/>parent)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Engine::Component::Transform\&\ parent\_transform\ =\ frame[bone-\/>parent-\/>index];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Engine::Component::Transform\&\ child\_transform\ =\ frame[bone-\/>index];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ local\_frame[bone-\/>index]\ =\ parent\_transform.as\_origin\_to(child\_transform);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ local\_frame[bone-\/>index]\ =\ frame[bone-\/>index];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ it++;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00216}00216\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00217}00217\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00218}00218\ \ \ \ \ \textcolor{keywordflow}{return}\ local\_frames;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00219}00219\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00220}00220\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00221}\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a353b82acaf603c6165d4b94f0d6526a7}{00221}}\ \mbox{\hyperlink{class_engine_1_1span}{Engine::span<Engine::anim\_mat4>}}\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a353b82acaf603c6165d4b94f0d6526a7}{Skeleton::get\_blend\_animation\_matrices}}(\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player}{AnimationPlayer}}\&\ player,\ \textcolor{keywordtype}{bool}\ advance\_time)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00222}00222\ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00223}00223\ \ \ \ \ \textcolor{comment}{//\ TOIMPROVE}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00224}00224\ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}\ =\ rest\_transforms;}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00225}00225\ \ \ \ \ std::vector<Engine::Component::Transform>\ local\_transforms(rest\_transforms.size());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00226}00226\ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{Bone::on\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}},\ [\&](\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}*\ bone)\{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00227}00227\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_afa3a8e2c71544d34604a84d2db4a3eba}{parent}})}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00228}00228\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ Engine::Component::Transform\&\ parent\_transform\ =\ bone\_transforms[bone-\/>parent-\/>index];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ Engine::Component::Transform\&\ child\_transform\ =\ bone\_transforms[bone-\/>index];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ local\_transforms[bone-\/>index]\ =\ parent\_transform.as\_origin\_to(child\_transform);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00232}00232\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00233}00233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ \ local\_transforms[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}]\ =\ rest\_transforms[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00235}00235\ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00236}00236\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ animation\ :\ player.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player_a61184ccf75ffe240cde8d2cf7f04e830}{animations}})}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00237}00237\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00238}00238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!animations.count(animation.name))}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::logic\_error(std::string(\textcolor{stringliteral}{"{}couldn't\ find\ the\ animation\ named:\ "{}})\ +\ animation.name);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00240}00240\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ anim\ =\ animations[animation.name];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00241}00241\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ frame\ =\ anim-\/>get\_local\_frames(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}})[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(fmod(player.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player_ae1888f164c726201fa7ed9da0bb954d1}{time}},\ anim-\/>duration)\ *\ anim-\/>frames.size()\ /\ anim-\/>duration)];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00242}00242\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00243}00243\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ local\_transforms.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00244}00244\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ jt\ =\ frame.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00245}00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ ft\ =\ local\_transforms.end();\ it\ !=\ ft;\ it++,\ jt++)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ \ \ (*it)\ =\ it-\/>interpolate(*jt,\ animation.weight);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00247}00247\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00248}00248\ \ \ \ \ \textcolor{comment}{//Bone::adjust\_bone\_positions(bone\_transforms,\ rest\_transforms,\ root\_bones);}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00249}00249\ \ \ \ \ \mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_a6159c6203d98747b5f5ac5011c62639e}{Bone::on\_bones}}(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a08b4d16ccf8914fa603aad8c72d0e8ad}{root\_bones}},\ [\&](\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone}{Bone}}*\ bone)\{}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00250}00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_afa3a8e2c71544d34604a84d2db4a3eba}{parent}})}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00251}00251\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}]\ =\ local\_transforms[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}].as\_local\_to(\mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_afa3a8e2c71544d34604a84d2db4a3eba}{parent}}-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}]);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00252}00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00253}00253\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}]\ =\ local\_transforms[bone-\/>\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_bone_adf692fdcd4bd5a926a80f8b8b6b15844}{index}}];}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00254}00254\ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00255}00255\ }
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00256}00256\ \ \ \ \ \textcolor{comment}{//\ converting\ bone\_transforms\ to\ mat4}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00257}00257\ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00258}00258\ \ \ \ \ \textcolor{keyword}{auto}\ jt\ =\ rest\_matrices.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00259}00259\ \ \ \ \ \textcolor{keyword}{auto}\ kt\ =\ models.begin();}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00260}00260\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ ft\ =\ \mbox{\hyperlink{class_engine_1_1_component_1_1_skeleton_a967ba9bacea9924396516d051a8e9805}{bone\_transforms}}.end();\ it\ !=\ ft;\ it++,\ jt++,\ kt++)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00261}00261\ \ \ \ \ \ \ \ \ (*kt)\ =\ it-\/>get\_matrix()\ *\ glm::inverse(*jt);}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00262}00262\ \ \ \ \ \textcolor{keywordflow}{if}\ (advance\_time)}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00263}00263\ \ \ \ \ \ \ \ \ player.\mbox{\hyperlink{struct_engine_1_1_component_1_1_skeleton_1_1_animation_player_ae1888f164c726201fa7ed9da0bb954d1}{time}}\ +=\ \mbox{\hyperlink{class_engine_1_1_app_a6f926dc22fc1fd49ee6d94e44292e62d}{App::app}}-\/>\mbox{\hyperlink{class_engine_1_1_app_a7c0e5165d1e0612c7e4f5b838cfd4c8c}{delta\_time}};}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00264}00264\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_engine_1_1span}{Engine::span<Engine::anim\_mat4>}}(models.data(),\ models.size());}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00265}00265\ \}}
\DoxyCodeLine{\Hypertarget{_skeleton_8cpp_source_l00266}00266\ }

\end{DoxyCode}
